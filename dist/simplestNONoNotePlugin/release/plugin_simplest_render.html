<!doctype html>
<html>
<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
  <script src="https://cdn.bootcss.com/jquery/3.2.1/jquery.min.js"></script>
  <script>'use strict';

var _createClass = function () { function defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if ("value" in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } } return function (Constructor, protoProps, staticProps) { if (protoProps) defineProperties(Constructor.prototype, protoProps); if (staticProps) defineProperties(Constructor, staticProps); return Constructor; }; }();

var _typeof = typeof Symbol === "function" && typeof Symbol.iterator === "symbol" ? function (obj) { return typeof obj; } : function (obj) { return obj && typeof Symbol === "function" && obj.constructor === Symbol && obj !== Symbol.prototype ? "symbol" : typeof obj; };

function _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError("Cannot call a class as a function"); } }

(function (root, factory) {
  if (typeof define === 'function' && define.amd) {
    // AMD. Register as an anonymous module.
    define(["nono_plugin_sdk"], factory);
  } else if ((typeof exports === 'undefined' ? 'undefined' : _typeof(exports)) === 'object') {
    // Node. Does not work with strict CommonJS, but only CommonJS-like environments
    // that support module.exports, like Node.
    module.exports = factory();
  } else {
    // Browser globals (root is window)
    window.NONoPluginSDK = factory();
  }
})(undefined, function () {
  "use strict";

  /**
  * import this file in your editor
  */
  /**
  * generate uuid for every message
  * @returns {string}
  */

  function uuidv4() {
    return 'xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx'.replace(/[xy]/g, function (c) {
      var r = Math.random() * 16 | 0,
          v = c == 'x' ? r : r & 0x3 | 0x8;
      return v.toString(16);
    });
  }
  /**
  *
  * considering the standard es 6 not support static property
  * we work around by a global var
  */

  // export default

  var NONoPluginSDK = function () {
    function NONoPluginSDK() {
      _classCallCheck(this, NONoPluginSDK);
    }

    _createClass(NONoPluginSDK, null, [{
      key: 'inject',
      value: function inject(actionHandler) {
        window.addEventListener('message', function (e) {
          var data = e.data;
          var action = data.action;
          var entityData = data.data;
          switch (action) {
            case "getData":
              window.parent.postMessage({
                type: "noteData",
                data: actionHandler.getNoteData(),
                uuid: uuidv4()
              }, "*");
              break;
            case "setData":
              console.log(entityData);
              if (!actionHandler.setNoteData) {
                console.warn("prepare to set data to editor,missing action handler!");
              }
              actionHandler.setNoteData(entityData);
              console.log("get new note data from nonobiji.com ", entityData);
              break;
            case "renderData":
              console.log(entityData);
              if (!actionHandler.renderNoteData) {
                console.warn("prepare to render data to redner,missing action handler!");
              }
              actionHandler.renderNoteData(entityData);
              console.log("render new note data from nonobiji.com ", entityData);
              break;
            case "qiniuUploadToken":
              NONoEditorRuntime.qiniuToken_inner = entityData;
              break;
            case "setFullScreenState":
              actionHandler.onFullScreenModeChanged(entityData);
              break;
          }
        });

        window.parent.postMessage({
          type: "noteEditorInjectFinished",
          uuid: uuidv4()
        }, "*");
        $(document.body).on('keydown', function (event) {

          /**
          * Handle ESC Pressed
          */
          if (event.keyCode === 27) {
            event.preventDefault();
            window.parent.postMessage({
              type: "hotkeyProxy",
              data: {
                event: {
                  keyCode: event.keyCode,
                  ctrlKey: event.ctrlKey,
                  metaKey: event.metaKey,
                  which: event.which
                }
              }
            }, "*");
          }
          if (event.ctrlKey || event.metaKey) {
            switch (String.fromCharCode(event.which).toLowerCase()) {
              case 's':
                event.preventDefault();
                window.parent.postMessage({
                  type: "hotkeyProxy",
                  data: {
                    event: {
                      keyCode: event.keyCode,
                      ctrlKey: event.ctrlKey,
                      metaKey: event.metaKey,
                      which: event.which
                    }
                  }
                }, "*");
                break;
            }
          }
        });
        /**
        * parent will remove the "loading mask" after 5s automatically
        */
        //setTimeout(this.setEditorReady ,5000);
      }
    }, {
      key: 'setEditorReady',

      /**
      *When this function is called ,parent remove the "loading mask" upon the editor instantly
      * if the function is not called,parent will remove the "loading mask" after 5s
      */
      value: function setEditorReady() {
        console.log("setEditorReady");
        if (!this.isEditorReadySet) {
          console.log("in child", " noteEditorReady sent");
          window.parent.postMessage({
            type: "noteEditorReady",
            data: "miaowuwuuw",
            uuid: uuidv4()
          }, "*");
          this.isEditorReadySet = true;
        }
      }
    }, {
      key: 'QINIU_TOKEN',
      get: function get() {
        if (!NONoPluginSDK.qiniuToken_inner) {
          console.warn("qiniu token not ready!");
        }
        return NONoPluginSDK.qiniuToken_inner;
      }
    }]);

    return NONoPluginSDK;
  }();

  NONoPluginSDK.isEditorReadySet = false;
  NONoPluginSDK.qiniuToken_inner = null;

  var ActionHandler = function () {
    function ActionHandler() {
      _classCallCheck(this, ActionHandler);
    }

    _createClass(ActionHandler, [{
      key: 'getNoteData',

      /**
      * retrieve note data from editor
      * return {
      *  note_title,
      *  note_content,
      *  note_abstract
      * }
      */
      value: function getNoteData() {}

      /**
      * set content of note editor
      * noteData: {
      *  note_title,
      *  note_content,
      *  note_abstract
      * }
      */

    }, {
      key: 'setNoteData',
      value: function setNoteData(noteData) {}

      /**
      * render content of note editor
      * noteData: {
      *  note_title,
      *  note_content,
      *  note_abstract
      * }
      */

    }, {
      key: 'renderNoteData',
      value: function renderNoteData(noteData) {}

      /**
      * listen for some UI state
      * @param is_fullscreen
      */

    }, {
      key: 'onFullScreenModeChanged',
      value: function onFullScreenModeChanged(is_fullscreen) {}
    }]);

    return ActionHandler;
  }();

  return NONoPluginSDK;
});</script>
  <script>
    NONoPluginSDK.inject({
    renderNoteData:({note_title,note_content,note_abstract})=>{
        $("#note_title").html(note_title);
        $("#note_content").html(note_content);
    }
})
  </script>
</head>

<body>
    <div id="article" class="rich_media">
                <div class="rich_media_primary">
                    <h3 class="rich_media_title" id="note_title">
                    </h3>
                <div class="rich_media_content" id="note_content">
                </div>
            </div>
    </div>
</body>
  <link href="https://cdn.bootcss.com/bootstrap/3.3.7/css/bootstrap.min.css" rel="stylesheet">
  <style>
  @media screen and (max-width: 736px){
    .rich_media_primary {
      position: relative;
      padding: 20px 15px 15px;
      width: 100%;
      background-color: #fff;
    }
  }
  @media screen and (min-width: 736px){
    .rich_media_primary {
      padding: 0px 10% 20px;
      width: 100%;
      position: relative;
      background-color: #fff;
      margin-left: auto;
      margin-right: auto;
    }
  }
  .rich_media_title{
    color: #000000;
    margin-right: 10px;
    display: inline-block;
    margin-top: 10px;
  }
  .rich_media_content{
    position: relative;
    overflow: auto;
    color: #3e3e3e;
    margin: 0;
    padding: 0;
    word-wrap: break-word;
    min-height:200px;
  }
  .rich_media_content p{
    color: #2f2f2f;
    font-size: 16px;
    font-weight: normal;
    line-height: 1.7 !important;
    word-break: break-word;
    text-align: justify;
    display: block;
    -webkit-margin-before: 1em;
    -webkit-margin-after: 1em;
    -webkit-margin-start: 0px;
    -webkit-margin-end: 0px;
  }
  .rich_media_info .avatar {
    display: inline-block;
    width: 40px;
    height: 40px;
    margin-right: 5px;
    border-radius: 50%;
  }
  .rich_media_info{
    position: relative;
    z-index: 1;
    margin-bottom: 18px;
    line-height: 50px;
  }
  img {
    max-width: 100%;
    height: auto;
    vertical-align: middle;
    border: 0;
    -ms-interpolation-mode: bicubic;
  }
  .label_normal {
    background: none;
    border: 1px solid #00BCD4;
    color: #00BCD4;
    text-shadow: none;
    font-size: 18px;
    font-weight: normal;
    line-height: 1;
    margin-right: 5px;
    border-radius: 3px;
    display: inline-block;
    padding: 2px 4px;
  }
  .label_sup {
    background: none;
    border: 1px solid #00BCD4;
    color: #00BCD4;
    display: inline-block;
    padding: 2px 4px;
    text-shadow: none;
    font-size: 12px;
    font-weight: normal;
    line-height: 1;
    border-radius: 2px;
    margin: 10px 10px;
  }
  .min_bg_shadow{
    background: #FAFAFA;
    width: 40px;
    height: 20px;
  }
  .middle_bg_shadow{
    background: #FAFAFA;
    width: 300px;
    height: 40px;
  }
  .max_bg_shadow{
    background: #FAFAFA;
    width: 700px;
    height: 400px;
  }
  .rich_media_primary hr{
    margin: 20px 20px 20px 20px;
    border-top: 1px solid #d9d9d9;
  }
  .rich_media_primary .footer{
    text-align: center;
    display: inline-block;
    margin-bottom: 40px;
    padding-left: 20px;
    padding-right:20px;
    margin-left: auto;
    margin-right:auto;;
    margin-bottom: 20px;
    font: normal normal normal 14px/1 FontAwesome;
    font-size: inherit;
    text-rendering: auto;
    -webkit-font-smoothing: antialiased;
    color:#00BCD4;
    font-family: "lucida grande", "lucida sans unicode", lucida, helvetica, "Hiragino Sans GB", "Microsoft YaHei", "WenQuanYi Micro Hei", sans-serif;
  }
  .rich_media_primary .footer a{
    text-decoration: none;
    color:#4094c7;
  }
  .rich_media{
    width:100%;
  }</style>
</html>
